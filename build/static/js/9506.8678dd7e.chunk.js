(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[9506],{24220:(e,t,a)=>{"use strict";a.d(t,{R:()=>l});var s=a(72791),c=a(89704),n=a.n(c);const i={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_ARCHIEVED:"http://api1.chandrakala.co.in/api/Tickets/ArchivedByUser",REACT_APP_API_CHANGE_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ChangePassword",REACT_APP_API_DEPARTMENTS:"http://api1.chandrakala.co.in/api/Departments",REACT_APP_API_DESIGNATION:"http://api1.chandrakala.co.in/api/Designation",REACT_APP_API_FORGOT_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ForgetPassword",REACT_APP_API_LOGIN:"http://api1.chandrakala.co.in/api/Login",REACT_APP_API_MODULE:"http://api1.chandrakala.co.in/api/Modules",REACT_APP_API_PERMISSION:"http://api1.chandrakala.co.in/api/Permission",REACT_APP_API_PROJECTTYPE:"http://api1.chandrakala.co.in/api/ProjectType",REACT_APP_API_TICKET:"http://api1.chandrakala.co.in/api/Tickets",REACT_APP_API_TICKETFLOW:"http://api1.chandrakala.co.in/api/TicketFlow",REACT_APP_API_TICKETFLOW_BY_COMMENTS:"http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId",REACT_APP_API_TICKETTYPE:"http://api1.chandrakala.co.in/api/TicketTypes",REACT_APP_API_TICKET_COMPLETED:"http://api1.chandrakala.co.in/api/Tickets/MarkCompleted",REACT_APP_API_UPLOAD:"http://api1.chandrakala.co.in/api/Users/upload",REACT_APP_API_USERS:"http://api1.chandrakala.co.in/api/Users",REACT_APP_API_USER_BY_ID:"http://api1.chandrakala.co.in/api/Users",REACT_APP_BASE_API_URL:"http://api1.chandrakala.co.in/api",REACT_APP_BASE_URL:"http://api1.chandrakala.co.in",REACT_APP_MY_SERVER:"http://test1.chandrakala.co.in"}.REACT_APP_SECRET_KEY||"ghjsfysdg123",r=(0,s.createContext)({encrypt:e=>{console.log("Data to encrypt:",e);const t=n().AES.encrypt(e.toString(),i).toString();return console.log("Encrypted data:",t),t.replace(/\//g,";")},decrypt:e=>{if("string"!==typeof e)return e;e=e.replace(/;/g,"/");return n().AES.decrypt(e,i).toString(n().enc.Utf8)}}),l=()=>(0,s.useContext)(r)},95513:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var s=a(72791),c=a(47022),n=a(89743),i=a(2677),r=a(43360),l=a(24849),d=a(62591),o=a(47798),h=a(12576),p=a(17612),x=a(88890),j=a.n(x),m=a(11087),u=a(9806),_=a(11632),A=a(55294),k=a(24220),T=a(80184);const g="http://api1.chandrakala.co.in",C=e=>{let{tickets:t,setTickets:a}=e;const{encrypt:c}=(0,k.R)(),[n,i]=(0,s.useState)(!1),[l,x]=(0,s.useState)(null),[C,P]=(0,s.useState)({}),[E,f]=(0,s.useState)(!1),[S,y]=(0,s.useState)(!1),[I,v]=(0,s.useState)(!1),N=(0,s.useRef)(null);(0,s.useEffect)((()=>{N.current&&j()(N.current).DataTable({order:[[4,"desc"]]});t.forEach((e=>{(async e=>{try{const t=await fetch("".concat("http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId","/").concat(e));if(!t.ok)throw new Error("HTTP error! Status: ".concat(t.status));const a=await t.json(),s=a.length>0?a[a.length-1].comment:"No comments";P((t=>({...t,[e]:s})))}catch(t){console.error("Error fetching comments for ticket ".concat(e,":"),t)}})(e.ticketId)}))}),[t]);const Z=()=>{x(null),f(!1)},D=()=>{console.log("Archiving ticket:",l),A.Z.put("".concat("http://api1.chandrakala.co.in/api/Tickets","/").concat(l.ticketId,"/archive")).then((e=>{console.log("Ticket archived successfully:",e.data),a(t.filter((e=>e.ticketId!==l.ticketId)))})).catch((e=>{console.error("Error archiving ticket:",e)})),Z()};return(0,T.jsxs)("div",{className:"mt-6 table-responsive",children:[(0,T.jsxs)(d.Z,{striped:!0,bordered:!0,hover:!0,ref:N,className:"table-primary",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{children:"S.No"}),(0,T.jsx)("th",{children:"Title"}),(0,T.jsx)("th",{children:"Status"}),(0,T.jsx)("th",{children:"Priority"}),(0,T.jsx)("th",{children:"DueDate"}),(0,T.jsx)("th",{children:"Creator Email"}),(0,T.jsx)("th",{children:"Actions"})]})}),(0,T.jsx)("tbody",{children:t.map(((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{children:t+1}),(0,T.jsx)("td",{children:(0,T.jsx)(o.Z,{placement:"top",delay:{show:250,hide:400},overlay:(0,T.jsx)(h.Z,{id:"tooltip-".concat(e.ticketId),children:C[e.ticketId]?(0,T.jsxs)(T.Fragment,{children:["Last comment:",(0,T.jsx)("div",{dangerouslySetInnerHTML:{__html:C[e.ticketId]}})]}):(0,T.jsxs)("div",{children:["Description: ",(0,T.jsx)("br",{}),e.description]})}),children:(0,T.jsx)("span",{children:e.title})},e.ticketId)}),(0,T.jsx)("td",{children:e.status}),(0,T.jsx)("td",{children:e.priority}),(0,T.jsx)("td",{children:new Date(e.dueDate).toLocaleString()}),(0,T.jsx)("td",{children:e.email}),(0,T.jsx)("td",{children:(0,T.jsxs)("div",{className:"d-flex gap-3 align-items-center",children:[(0,T.jsx)(m.rU,{to:"/Tickets/EditTicket/".concat(c(e.ticketId)),children:(0,T.jsx)(u.G,{icon:_.e0A,className:"text-primary"})}),(0,T.jsx)(r.Z,{variant:"link",onClick:()=>(e=>{x(e),i(!0)})(e),children:(0,T.jsx)(u.G,{icon:_.Mdf,className:"text-success"})}),(0,T.jsx)(u.G,{icon:_.On6,className:"text-danger",onClick:()=>(e=>{x(e),f(!0)})(e)}),(0,T.jsxs)(p.Z,{show:E,onHide:Z,children:[(0,T.jsx)(p.Z.Header,{closeButton:!0,children:(0,T.jsx)(p.Z.Title,{children:"Confirm Archive"})}),(0,T.jsxs)(p.Z.Body,{children:["Are you sure you want to archive ticket ",l?l.id:"","?"]}),(0,T.jsxs)(p.Z.Footer,{children:[(0,T.jsx)(r.Z,{variant:"secondary",onClick:Z,children:"Cancel"}),(0,T.jsx)(r.Z,{variant:"danger",onClick:D,children:"Archive"})]})]})]})})]},e.ticketId)))})]}),l&&(0,T.jsxs)(p.Z,{show:n,onHide:()=>i(!1),size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[(0,T.jsx)(p.Z.Header,{closeButton:!0,children:(0,T.jsx)(p.Z.Title,{id:"contained-modal-title-vcenter",children:"Ticket Details"})}),(0,T.jsxs)(p.Z.Body,{children:[(0,T.jsxs)("p",{children:["Title: ",l.title]}),(0,T.jsxs)("p",{children:["Description: ",l.description]}),(0,T.jsxs)("p",{children:["Creator ID: ",l.email]}),(0,T.jsxs)("p",{children:["Assignee ID: ",l.assigneeEmail]}),(0,T.jsx)("p",{children:"Attachments:"}),l.attachment&&(0,T.jsx)("div",{children:I&&/\.(png|jpg|jpeg|gif|bmp)$/i.test(l.attachment)?(0,T.jsx)("img",{src:"".concat(g,"/").concat(l.attachment.replace("wwwroot/","")),alt:"Attachment",className:"img-fluid"}):(0,T.jsx)("p",{children:(0,T.jsx)("a",{href:"".concat(g,"/").concat(l.attachment.replace("wwwroot/","")),target:"_blank",rel:"noopener noreferrer",children:"View Attachment"})})})]}),(0,T.jsx)(p.Z.Footer,{children:(0,T.jsx)(r.Z,{onClick:()=>i(!1),children:"Close"})})]})]})};var P=a(583),E=a(30734),f=a(45471),S=a(55087),y=a(6265),I=a(58990);a(41112);const v="http://api1.chandrakala.co.in/api/Tickets",N=()=>{const{user:e}=(0,P.a)(),[t,a]=(0,s.useState)({open:0,pending:0,selfassigned:0,completed:0}),[c,n]=(0,s.useState)([]),[i,r]=(0,s.useState)(!0);return(0,s.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(v,"/status-count?email=").concat(e.email)),s=await t.json();a({open:s.openCount,pending:s.pendingCount,selfassigned:s.selfassignedCount,completed:s.completedCount});const c=await fetch("".concat(v,"/ByUser?email=").concat(e.email)),i=await c.json();n(i),r(!1)}catch(t){console.error("Error fetching data:",t)}finally{r(!1)}})()}),[e]),(0,T.jsx)(E.r,{children:(0,T.jsx)(f.b,{xs:12,className:"d-flex align-items-center justify-content-center",children:(0,T.jsx)(S.x,{className:"mb-4 ",style:{height:"370px"},children:(0,T.jsx)(y.s,{children:0==t.open&&0==t.pending&&0==t.selfassigned&&0==t.completed?(0,T.jsx)(I.fH,{data:{labels:["No Data"],datasets:[{data:[100],backgroundColor:["#CCCCCC"],hoverBackgroundColor:["#CCCCCC"]}]}}):(0,T.jsx)(I.fH,{data:{labels:["Open","Pending","Self-Assigned","Completed"],datasets:[{data:[t.open,t.pending,t.selfassigned,t.completed],backgroundColor:["#08683A","#36A2EB","#FFFF33","#F77000"],hoverBackgroundColor:["#08683A","#36A2EB","#FFFF33","#F77000"]}]}})})})})})};var Z=a(54694);const D=()=>{const[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(!1),{user:n,isLoading:i,isError:r}=(0,P.a)(),[l,o]=(0,s.useState)([]),[h,p]=(0,s.useState)([]);(0,s.useEffect)((()=>{i||r||x()}),[i,r,n.email]);const x=async()=>{c(!0);try{const e=(await A.Z.get("".concat("http://api1.chandrakala.co.in","/api/Tickets?userId=").concat(n.userId))).data.filter((e=>e.assigneeEmail===n.email));t(e);const a=j(e),s=m(e);o(a),p(s)}catch(e){console.error("Error fetching tickets:",e)}finally{c(!1)}},j=e=>{const t=(new Date).toISOString().split("T")[0];return e.filter((e=>e.dueDate.split("T")[0]===t))},m=e=>{const t=new Date,a=new Date;return a.setDate(t.getDate()+2),e.filter((e=>{const s=new Date(e.dueDate);return s>t&&s<=a}))};return i?(0,T.jsx)("div",{children:"Loading..."}):r?(0,T.jsx)("div",{children:"Error fetching user data."}):(0,T.jsxs)("div",{children:[0===l.length?(0,T.jsx)(Z.Z,{className:"mt-2",children:(0,T.jsx)(Z.Z.Body,{children:(0,T.jsx)("div",{className:"text-center",children:"No tasks due today."})})}):(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(Z.Z,{className:"mt-2",children:(0,T.jsx)(Z.Z.Body,{children:(0,T.jsxs)(d.Z,{striped:!0,bordered:!0,hover:!0,children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{children:"S.No"}),(0,T.jsx)("th",{children:"Title"}),(0,T.jsx)("th",{children:"Deadline"})]})}),(0,T.jsx)("tbody",{children:l.map(((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{children:t+1}),(0,T.jsx)("td",{children:e.title}),(0,T.jsx)("td",{children:e.dueDate.split("T")[0]})]},e.ticketId)))})]})})})}),h.length>0&&(0,T.jsx)(Z.Z,{className:"mt-2",children:(0,T.jsxs)(Z.Z.Body,{children:[(0,T.jsx)("h5",{children:"Upcoming Due Date Tasks"}),(0,T.jsxs)(d.Z,{striped:!0,bordered:!0,hover:!0,children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{children:"S.No"}),(0,T.jsx)("th",{children:"Title"}),(0,T.jsx)("th",{children:"Deadline"})]})}),(0,T.jsx)("tbody",{children:h.map(((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{children:t+1}),(0,T.jsx)("td",{children:e.title}),(0,T.jsx)("td",{children:e.dueDate.split("T")[0]})]},e.ticketId)))})]})]})})]})};var R=a(57689);const w="http://api1.chandrakala.co.in/api/Tickets",b=()=>{const{user:e}=(0,P.a)(),[t,a]=(0,s.useState)({open:0,pending:0,selfassigned:0,completed:0}),[d,o]=(0,s.useState)([]),[h,p]=(0,s.useState)(!0),[x,j]=(0,s.useState)(!1);(0,R.s0)();(0,s.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(w,"/status-count?email=").concat(e.email)),s=await t.json();a({open:s.openCount,pending:s.pendingCount,selfassigned:s.selfassignedCount,completed:s.completedCount});const c=await fetch("".concat(w,"/ByUser?email=").concat(e.email)),n=await c.json();o(n),p(!1)}catch(t){console.error("Error fetching data:",t)}finally{p(!1)}})()}),[e]);return(0,T.jsxs)("div",{children:[(0,T.jsx)(c.Z,{children:(0,T.jsxs)(n.Z,{className:"row-cols-1 row-cols-md-2",children:[(0,T.jsxs)(i.Z,{md:6,children:[(0,T.jsxs)(n.Z,{className:"mb-3",children:[(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.open})}),(0,T.jsx)("p",{className:"name-client",children:"Open"})]})}),(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.pending})}),(0,T.jsx)("p",{className:"name-client",children:"Pending"})]})})]}),(0,T.jsxs)(n.Z,{children:[(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.selfassigned})}),(0,T.jsx)("p",{className:"name-client",children:"Self Assigned"})]})}),(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.completed})}),(0,T.jsx)("p",{className:"name-client",children:"Completed"})]})})]})]}),(0,T.jsx)(i.Z,{md:4,style:{display:x?"none":"block"},children:(0,T.jsx)(N,{})}),(0,T.jsxs)(i.Z,{md:!x&&2,children:[(0,T.jsx)(n.Z,{children:(0,T.jsx)(i.Z,{children:(0,T.jsx)("div",{className:"text-end",children:(0,T.jsx)(r.Z,{onClick:()=>{j(!x)},variant:"danger",children:"Due Today"})})})}),(0,T.jsx)(n.Z,{children:(0,T.jsx)(i.Z,{children:x&&(0,T.jsx)(D,{})})})]})]})}),h?(0,T.jsx)("div",{className:"text-center",children:(0,T.jsx)(l.Z,{animation:"border",role:"status",children:(0,T.jsx)("span",{className:"visually-hidden",children:"loading.."})})}):(0,T.jsx)(C,{tickets:d,setTickets:o})]})}},42480:()=>{}}]);
//# sourceMappingURL=9506.8678dd7e.chunk.js.map