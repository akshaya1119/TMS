"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[4246],{75489:(e,a,t)=>{t.r(a),t.d(a,{default:()=>u});var s=t(55294),l=t(72791),c=t(583),n=t(24849),i=t(57689),r=t(2515),o=t(22120),d=t.n(o);const m=t.p+"static/media/greentick.ef2ae37034b7e6bd95f0.jpg";t(30994);var p=t(17372),h=t(80184);const u=()=>{const e=(0,i.s0)(),{user:a}=(0,c.a)(),[t,o]=(0,l.useState)(!1),[u,x]=(0,l.useState)([]),[j,g]=(0,l.useState)([]),[f,N]=(0,l.useState)([]),[b,v]=(0,l.useState)({email:a.email,priority:"low",title:"",department:"",ticketType:"",status:"Active",projectType:"",dueDate:"",description:"",assigneeEmail:"",attachments:null}),[y,k]=(0,l.useState)(null),[T,w]=(0,l.useState)(null);(0,l.useEffect)((()=>{const e=(new p.s).withUrl("https://localhost:7217/notificationHub/").build();return w(e),e.start().then((()=>console.log("SignalR Connected"))).catch((e=>console.error("SignalR Connection Error: ",e))),()=>{e.stop()}}),[]),(0,l.useEffect)((()=>{!async function(){try{const e=await s.Z.get("http://api1.chandrakala.co.in/api/Users");N(e.data)}catch(e){console.error("Error fetching Assignee:",e)}}()}),[]),(0,l.useEffect)((()=>{!async function(){try{const e=await s.Z.get("http://api1.chandrakala.co.in/api/TicketTypes");x(e.data)}catch(e){console.error("Error fetching Ticket Type:",e)}}()}),[]),(0,l.useEffect)((()=>{!async function(){try{const e=await s.Z.get("http://api1.chandrakala.co.in/api/ProjectType");g(e.data)}catch(e){console.error("Error fetching Project Type:",e)}}()}),[]);const E=e=>{const{name:t,value:s}=e.target||e;if("assigneeEmail"===t){const e=f.find((e=>e.email===s)),l=s.toLowerCase()===a.email.toLowerCase(),c=l?e.departmentName:(null===e||void 0===e?void 0:e.departmentName)||"";v((e=>({...e,[t]:s,department:c,status:l?"Self-Assigned":"Active"})))}else v((e=>({...e,[t]:s})))};(0,l.useEffect)((()=>{const e=f.find((e=>e.email===b.assigneeEmail)),t=b.assigneeEmail.toLowerCase()===a.email.toLowerCase(),s=t?e.departmentName:(null===e||void 0===e?void 0:e.departmentName)||"";v((e=>({...e,department:s,status:t?"Self-Assigned":"Active"})))}),[b.assigneeEmail,f,a]);return(0,h.jsxs)("div",{className:"container mt-5",children:[(0,h.jsx)("div",{className:"d-flex justify-content-between"}),y&&(0,h.jsx)("div",{className:"alert ".concat(y.includes("successfully")?"alert-success":"alert-danger"),role:"alert",children:y}),(0,h.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),o(!0);const l=Object.entries(b).map((e=>{let[a,t]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t))})).join("&"),c=new FormData;Object.entries(b).forEach((e=>{let[a,t]=e;if("attachments"===a){if(t)for(let s=0;s<t.length;s++)c.append("attachments",t[s])}else c.append(a,t)}));try{const t=await s.Z.post("".concat("http://api1.chandrakala.co.in/api/Tickets","?").concat(l),c,{headers:{"Content-Type":"multipart/form-data"}});console.log(t),k("Ticket added successfully!"),o(!1),T&&T.invoke("SendTicketAssignmentNotification",b.assigneeEmail,"New ticket added: ".concat(b.title)),d()({title:"Ticket",message:"New ticket has been assigned",duration:11e3,icon:m,native:!0,onClick:()=>window.location="".concat("http://ticket.chandrakala.co.in")}),v({email:a.email,priority:"low",title:"",department:"",ticketType:"",status:"Active",projectType:"",dueDate:"",description:"",assigneeEmail:"",attachments:null}),e("/Tickets/AddTicket/".concat(t.data.userId))}catch(n){console.error(n),k("Error adding ticket. Please try again."),o(!1)}},children:[(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsx)("label",{htmlFor:"ticketId",className:"col-sm-3 col-form-label text-end",children:"Ticket ID:"}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("input",{type:"text",className:"form-control",id:"ticketId",name:"ticketId",placeholder:"Ticket ID",required:!0,onChange:E,disabled:!0,value:"0"})}),(0,h.jsxs)("label",{htmlFor:"priority",className:"col-sm-3 col-form-label text-end",children:["Priority",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsxs)("select",{className:"form-select",id:"priority",name:"priority",placeholder:"Select priority",required:!0,onChange:E,children:[(0,h.jsx)("option",{defaultValue:!0,children:"Select Priority"}),(0,h.jsx)("option",{value:"low",children:"Low"}),(0,h.jsx)("option",{value:"medium",children:"Medium"}),(0,h.jsx)("option",{value:"high",children:"High"})]})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsxs)("label",{htmlFor:"title",className:"col-sm-3 col-form-label text-end",children:["Title",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("input",{type:"text",className:"form-control",id:"title",name:"title",placeholder:"Enter title",required:!0,onChange:E})}),(0,h.jsxs)("label",{htmlFor:"department",className:"col-sm-3 col-form-label text-end",children:["Department",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("input",{className:"form-control",id:"department",name:"department",value:b.department||"",required:!0,onChange:E,readOnly:!0,disabled:!0})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsxs)("label",{htmlFor:"ticketType",className:"col-sm-3 col-form-label text-end",children:["Ticket Type",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)(r.ZP,{options:u.map((e=>({label:e.ticketType,value:e.ticketType}))),value:{label:b.ticketType,value:b.ticketType},onChange:e=>E({target:{name:"ticketType",value:e.value}}),isSearchable:!0,placeholder:"Select Ticket Type"})}),(0,h.jsxs)("label",{htmlFor:"status",className:"col-sm-3 col-form-label text-end",children:["Status",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("input",{className:"form-control",id:"status",name:"status",value:b.status,required:!0,onChange:E,readOnly:!0,disabled:!0})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsxs)("label",{htmlFor:"email",className:"col-sm-3 col-form-label text-end",children:["Creator",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("input",{type:"text",className:"form-control",id:"email",name:"email",placeholder:"Enter your Email",required:!0,value:a.email,onChange:E,disabled:!0})}),(0,h.jsxs)("label",{htmlFor:"assigneeEmail",className:"col-sm-3 col-form-label text-end",children:["Assignee Email",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)(r.ZP,{options:f.map((e=>({label:e.email,value:e.email}))),value:{label:b.assigneeEmail,value:b.assigneeEmail},onChange:e=>E({target:{name:"assigneeEmail",value:e.value}}),isSearchable:!0,placeholder:"Select Assignee"})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsxs)("label",{htmlFor:"projectType",className:"col-sm-3 col-form-label text-end",children:["Project Type",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)(r.ZP,{options:j.map((e=>({label:e.projectTypes,value:e.projectTypes}))),value:{label:b.projectType,value:b.projectType},onChange:e=>E({target:{name:"projectType",value:e.value}}),isSearchable:!0,placeholder:"Select Project Type"})}),(0,h.jsxs)("label",{htmlFor:"dueDate",className:"col-sm-3 col-form-label text-end",children:["Due Date",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-3",children:(0,h.jsx)("input",{type:"date",className:"form-control",id:"dueDate",name:"dueDate",placeholder:"Select Due Date",required:!0,onChange:E})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsxs)("label",{htmlFor:"description",className:"col-sm-3 col-form-label text-end",children:["Description",(0,h.jsx)("span",{className:"text-danger",children:" * "})]}),(0,h.jsx)("div",{className:"col-sm-9",children:(0,h.jsx)("textarea",{className:"form-control",id:"description",name:"description",placeholder:"Enter description",rows:"4",required:!0,onChange:E})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsx)("label",{htmlFor:"attachments",className:"col-sm-3 col-form-label text-end",children:"Attachments:"}),(0,h.jsx)("div",{className:"col-sm-9",children:(0,h.jsx)("input",{type:"file",className:"form-control",id:"attachments",name:"attachments",multiple:!0,onChange:e=>{v((a=>({...a,attachments:e.target.files})))}})})]}),(0,h.jsxs)("div",{className:"row mb-3",children:[(0,h.jsx)("div",{className:"col-sm-3"}),(0,h.jsx)("div",{className:"col-sm-9 text-end",children:(0,h.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:t,children:t?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.Z,{animation:"border",size:"sm"})," Adding Ticket..."]}):"Add Ticket"})})]})]})]})}}}]);
//# sourceMappingURL=4246.7d7132aa.chunk.js.map