"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[3517],{33517:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var n=s(72791),a=s(42443),c=s(583),r=s(55294),l=s(88890),i=s.n(l),o=s(57689),d=s(16574),u=s(80184);const h="http://api1.chandrakala.co.in",m="http://api1.chandrakala.co.in/api/Users",p="http://api1.chandrakala.co.in/api/Tickets",x=()=>{const{userId:e}=(0,o.UO)(),t=((0,n.useRef)(null),(0,n.useRef)(null)),s=(0,n.useRef)(null),[l,x]=(0,n.useState)({}),{user:j}=(0,c.a)(),f=e||j.userId,[g,v]=(0,n.useState)(!1),[N,b]=(0,n.useState)(null),[w,P]=(0,n.useState)(!1),[k,y]=(0,n.useState)(null),[T,E]=(0,n.useState)(null),{updateProfileImageUrl:A}=(0,d.i)(),[I,K]=(0,n.useState)();(0,n.useEffect)((()=>{f&&fetch("".concat(m,"/").concat(f),{headers:{Authorization:"Bearer ".concat(null===j||void 0===j?void 0:j.token)}}).then((e=>e.json())).then((e=>{x(e)})).catch((e=>{console.error("Error fetching user details:",e)}))}),[f]),(0,n.useEffect)((()=>{I&&fetch("".concat(m,"/").concat(f),{headers:{Authorization:"Bearer ".concat(null===j||void 0===j?void 0:j.token)}}).then((e=>e.json())).then((e=>{x(e)})).catch((e=>{console.error("Error fetching updated user details:",e)}))}),[I]),(0,n.useEffect)((()=>{null!==l&&void 0!==l&&l.email&&(_(),S())}),[null===l||void 0===l?void 0:l.email]),(0,n.useEffect)((()=>{null!==k&&C(t,k)}),[k]),(0,n.useEffect)((()=>{null!==T&&C(s,T)}),[T]);const C=(e,t)=>{let s=0;const n=t/50,a=setInterval((()=>{s+=n,s>=t&&(s=t,clearInterval(a)),i()(e.current).find(".counter-value").text(Math.ceil(s.toString()))}),40)},_=async()=>{try{const e=await fetch("".concat(p,"/status-count?id=").concat(l.userId),{headers:{Authorization:"Bearer ".concat(null===j||void 0===j?void 0:j.token)}});if(!e.ok)throw new Error("Error fetching assigned tickets count: ".concat(e.status));const t=await e.json(),s=(null===t||void 0===t?void 0:t.openCount)+t.pendingCount+t.selfassignedCount+t.completedCount;y(s)}catch(e){console.error("Error fetching assigned tickets count:",e)}},S=async()=>{try{const e=await fetch("".concat(p,"/status-count?id=").concat(l.userId),{headers:{Authorization:"Bearer ".concat(null===j||void 0===j?void 0:j.token)}});if(!e.ok)throw new Error("Error fetching resolved tickets count: ".concat(e.status));const t=(await e.json()).completedCount;E(t)}catch(e){console.error("Error fetching resolved tickets count:",e)}};return(0,u.jsx)("section",{style:{backgroundColor:"#f8f9fa",padding:"20px"},children:(0,u.jsx)(a.L5,{className:"py-5",children:(0,u.jsxs)(a.uZ,{children:[(0,u.jsxs)(a.TK,{lg:"4",children:[(0,u.jsxs)(a.Yl,{className:"mb-4",children:[(0,u.jsx)("div",{children:(0,u.jsxs)(a.H7,{className:"text-center d-flex flex-column align-items-center position-relative",children:[(0,u.jsx)("div",{className:"rounded-circle overflow-hidden position-relative  border border-2 border-primary",style:{width:"150px",height:"150px",overflow:"hidden"},children:(0,u.jsx)(a.PH,{id:"previewImage",src:null!==l&&void 0!==l&&l.profilePicturePath?"".concat(h,"/").concat(l.profilePicturePath,"?timestamp=").concat(Date.now()):"https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3.webp",alt:"avatar",className:"w-100 h-100",fluid:!0})}),(0,u.jsx)("label",{htmlFor:"fileInput",className:"position-absolute bottom-0 end-0 m-2",children:(0,u.jsx)(a.vm,{icon:"pen",className:"text-dark"})}),(0,u.jsx)("input",{type:"file",id:"fileInput",className:"d-none",accept:"jpg,jpeg,png,svg",onChange:e=>{const t=e.target.files[0];b(t),v(!0);const s=URL.createObjectURL(t);document.getElementById("previewImage").src=s}})]})}),g&&(0,u.jsx)("button",{className:"btn btn-sm btn-primary",onClick:async()=>{if(N){if(!(e=>{const t=e.name.split(".").pop().toLowerCase();return["jpg","jpeg","png","svg"].includes(t)})(N))return void alert("Invalid file format. Only jpg, jpeg, png, and svg files are allowed.");P(!0);try{const e=new FormData;e.append("image",N);const t=await r.Z.post("".concat(m,"/upload/").concat(f),e,{headers:{Authorization:"Bearer ".concat(null===j||void 0===j?void 0:j.token)}}),s="".concat(h,"/").concat(t.data.filePath,"?").concat((new Date).getTime());x((e=>({...e,profilePicturePath:t.data.filePath}))),K(s),A(j.userId,s),v(!1),await _(),await S()}catch(e){console.error("Error updating profile picture:",e)}finally{P(!1)}}},disabled:w,children:w?"Loading...":"Submit"})]}),(0,u.jsx)(a.Yl,{className:"mb-4 mb-lg-0",children:(0,u.jsx)(a.H7,{className:"p-0",children:(0,u.jsxs)(a.d8,{flush:"true",classNa:!0,me:"rounded-3",children:[(0,u.jsxs)(a.FQ,{className:"d-flex justify-content-between align-items-center p-3 fs-5",ref:t,style:{backgroundColor:"#FA8247"},children:[(0,u.jsx)(a.Pp,{className:"counter-value fw-bold fs-3",children:k}),(0,u.jsx)(a.Pp,{children:"Total Tickets Assigned"})]}),(0,u.jsxs)(a.FQ,{className:"d-flex justify-content-between align-items-center p-3 fs-5",ref:s,style:{backgroundColor:"#83F28F"},children:[(0,u.jsx)(a.Pp,{className:"counter-value fw-bold fs-3",children:T}),(0,u.jsx)(a.Pp,{children:"Tickets Resolved"})]})]})})})]}),(0,u.jsx)(a.TK,{lg:"8",children:l?(0,u.jsx)(a.Yl,{className:"mb-4",children:(0,u.jsxs)(a.H7,{children:[(0,u.jsxs)(a.uZ,{children:[(0,u.jsx)(a.TK,{sm:"3",children:(0,u.jsx)(a.Pp,{children:"Full Name"})}),(0,u.jsx)(a.TK,{sm:"9",children:(0,u.jsx)(a.Pp,{className:"text-muted",children:"".concat(l.firstName," ").concat(l.lastName)||"N/A"})})]}),(0,u.jsx)("hr",{}),(0,u.jsxs)(a.uZ,{children:[(0,u.jsx)(a.TK,{sm:"3",children:(0,u.jsx)(a.Pp,{children:"Email"})}),(0,u.jsx)(a.TK,{sm:"9",children:(0,u.jsx)(a.Pp,{className:"text-muted",children:l.email||"N/A"})})]}),(0,u.jsx)("hr",{}),(0,u.jsxs)(a.uZ,{children:[(0,u.jsx)(a.TK,{sm:"3",children:(0,u.jsx)(a.Pp,{children:"Designation"})}),(0,u.jsx)(a.TK,{sm:"9",children:(0,u.jsx)(a.Pp,{className:"text-muted",children:l.designationName||"N/A"})})]}),(0,u.jsx)("hr",{}),(0,u.jsxs)(a.uZ,{children:[(0,u.jsx)(a.TK,{sm:"3",children:(0,u.jsx)(a.Pp,{children:"Department"})}),(0,u.jsx)(a.TK,{sm:"9",children:(0,u.jsx)(a.Pp,{className:"text-muted",children:l.departmentName||"N/A"})})]}),(0,u.jsx)("hr",{}),(0,u.jsxs)(a.uZ,{children:[(0,u.jsx)(a.TK,{sm:"3",children:(0,u.jsx)(a.Pp,{children:"Mobile"})}),(0,u.jsx)(a.TK,{sm:"9",children:(0,u.jsx)(a.Pp,{className:"text-muted",children:l.mobileNo||"N/A"})})]}),(0,u.jsx)("hr",{}),(0,u.jsxs)(a.uZ,{children:[(0,u.jsx)(a.TK,{sm:"3",children:(0,u.jsx)(a.Pp,{children:"Address"})}),(0,u.jsx)(a.TK,{sm:"9",children:(0,u.jsx)(a.Pp,{className:"text-muted",children:l.address||"N/A"})})]})]})}):(0,u.jsx)("p",{children:"Loading..."})})]})})})}}}]);
//# sourceMappingURL=3517.d63dbd15.chunk.js.map