(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[5696],{24220:(e,s,t)=>{"use strict";t.d(s,{R:()=>r});var a=t(72791),n=t(89704),i=t.n(n);const l={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_ARCHIEVED:"http://api1.chandrakala.co.in/api/Tickets/ArchivedByUser",REACT_APP_API_CHANGE_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ChangePassword",REACT_APP_API_DEPARTMENTS:"http://api1.chandrakala.co.in/api/Departments",REACT_APP_API_DESIGNATION:"http://api1.chandrakala.co.in/api/Designation",REACT_APP_API_FORGOT_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ForgetPassword",REACT_APP_API_LOGIN:"http://api1.chandrakala.co.in/api/Login",REACT_APP_API_MODULE:"http://api1.chandrakala.co.in/api/Modules",REACT_APP_API_PERMISSION:"http://api1.chandrakala.co.in/api/Permission",REACT_APP_API_PROJECTTYPE:"http://api1.chandrakala.co.in/api/ProjectType",REACT_APP_API_TICKET:"http://api1.chandrakala.co.in/api/Tickets",REACT_APP_API_TICKETFLOW:"http://api1.chandrakala.co.in/api/TicketFlow",REACT_APP_API_TICKETFLOW_BY_COMMENTS:"http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId",REACT_APP_API_TICKETTYPE:"http://api1.chandrakala.co.in/api/TicketTypes",REACT_APP_API_TICKET_COMPLETED:"http://api1.chandrakala.co.in/api/Tickets/MarkCompleted",REACT_APP_API_UPLOAD:"http://api1.chandrakala.co.in/api/Users/upload",REACT_APP_API_USERS:"http://api1.chandrakala.co.in/api/Users",REACT_APP_API_USER_BY_ID:"http://api1.chandrakala.co.in/api/Users",REACT_APP_BASE_API_URL:"http://api1.chandrakala.co.in/api",REACT_APP_BASE_URL:"http://api1.chandrakala.co.in",REACT_APP_MY_SERVER:"http://test1.chandrakala.co.in"}.REACT_APP_SECRET_KEY||"ghjsfysdg123",c=(0,a.createContext)({encrypt:e=>{console.log("Data to encrypt:",e);const s=i().AES.encrypt(e.toString(),l).toString();return console.log("Encrypted data:",s),s.replace(/\//g,";")},decrypt:e=>{if("string"!==typeof e)return e;e=e.replace(/;/g,"/");return i().AES.decrypt(e,l).toString(i().enc.Utf8)}}),r=()=>(0,a.useContext)(c)},20141:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Z});var a=t(72791),n=t(55294),i=t(57689),l=t(43360),c=t(89743),r=t(2677),o=t(17612),d=t(29795),m=t(24849),h=t(9806),p=t(11632),u=t(583),x=t(66770),j=t.n(x),g=(t(86009),t(24220)),T=t(80184);const k="http://api1.chandrakala.co.in",A=[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],Z=()=>{const{user:e}=(0,u.a)(),{ticketId:s}=(0,i.UO)(),{decrypt:t}=(0,g.R)(),x=t(s),[Z,y]=(0,a.useState)({ticketId:"",creatorName:"",priority:"",title:"",department:"",ticketType:"",status:"",project:"",dueDate:"",description:"",assigneeName:"",userAssigneeName:"",userTicketType:"",userStatus:"",userPriority:"",userComment:""}),[P,S]=(0,a.useState)(!1),[b,C]=(0,a.useState)([]),[_,N]=(0,a.useState)(""),[v,E]=(0,a.useState)(null),[w,f]=(0,a.useState)(null),[I,R]=(0,a.useState)([]),[D,L]=(0,a.useState)([]),[F,O]=(0,a.useState)(null),[G,U]=(0,a.useState)(!0),[M,W]=(0,a.useState)(!1),[B,H]=(0,a.useState)(!1),[K,Y]=(0,a.useState)(null),[q,V]=(0,a.useState)(!1),[z,J]=(0,a.useState)({}),[Q,X]=(0,a.useState)(!1);(0,a.useEffect)((()=>{!async function(){try{const[s,t,a,i]=await Promise.all([n.Z.get("".concat("http://api1.chandrakala.co.in/api/Tickets","/").concat(x)),n.Z.get("".concat("http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId","/").concat(x)).catch((()=>({data:[]}))),n.Z.get("http://api1.chandrakala.co.in/api/Users"),n.Z.get("http://api1.chandrakala.co.in/api/TicketTypes")]);y(s.data),console.log(s.data),f(s.data),C(t.data),R(a.data),J(a.data.filter((s=>s.userId===e.userId))[0]),console.log(a.data.filter((s=>s.userId===e.userId))[0]),L(i.data)}catch(s){console.error("Error fetching Ticket, Comments, Assignees, and Ticket Types:",s),console.log("Error details:",s.response),console.log("Status code:",s.response.status),E("Error fetching ticket, comments, assignees, and ticket types. Please try again.")}}(),O((new Date).toLocaleString())}),[x]);const $=e=>{const{name:s,value:t,type:a}=e.target;y((n=>({...n,[s]:"file"===a?e.target.files:t})))},ee=()=>{if(b.length>0){const e=b[b.length-1];console.log("Last Comment:",e),y({...Z,userAssigneeName:e.newAssigneeName,userAssigneeId:e.newAssigneeId,userTicketType:e.newTicketType,userStatus:e.newStatus,userPriority:e.newPriority,userTicketTypeId:e.newTicketTypeId}),console.log("Updated Form Data:",{...Z,userAssigneeName:e.newAssigneeName,userTicketType:e.newTicketType,userStatus:e.newStatus,userPriority:e.newPriority})}else y({...Z,userAssigneeName:Z.assigneeName,userAssigneeId:Z.assigneeId,userTicketType:Z.ticketType,userStatus:Z.status,userPriority:Z.priority,userTicketTypeId:Z.ticketTypeId}),console.log("Updated FormData:",Z);S(!P)},se=()=>{W(!1)};return console.log(Z),(0,T.jsxs)("div",{className:"container mt-3",children:[(0,T.jsxs)("div",{className:"d-flex justify-content-between ",children:[(0,T.jsx)("h4",{children:"Ticket Section"}),e.email===Z.email&&(0,T.jsxs)(l.Z,{onClick:async()=>{try{const e=await n.Z.put("".concat("http://api1.chandrakala.co.in/api/Tickets/MarkCompleted","/").concat(x),{status:"Completed"});console.log("Response:",e),200===e.status||204===e.status?(y((e=>({...e,status:"Completed"}))),E("Ticket marked as completed successfully!")):E("Error marking ticket as completed. Please try again.")}catch(e){console.error("Error marking ticket as completed:",e),E("Error marking ticket as completed.")}},disabled:"Completed"===Z.status,onMouseEnter:()=>{V(!0)},onMouseLeave:()=>{V(!1)},children:[q?(0,T.jsx)(h.G,{icon:p.LEp}):" ","Completed"===Z.status?"Completed":"Mark as Completed"]})]}),(0,T.jsxs)(c.Z,{children:[(0,T.jsxs)(r.Z,{children:[(0,T.jsx)("label",{htmlFor:"creatorName",className:"col-form-label text-end",children:"CreatorID:"}),(0,T.jsx)("div",{className:"",children:(0,T.jsx)("input",{type:"text",className:"form-control",id:"creatorName",name:"creatorName",value:Z.creatorName,required:!0,disabled:!0})})]}),(0,T.jsxs)(r.Z,{children:[(0,T.jsx)("label",{htmlFor:"title",className:"col-form-label text-end",children:"Title:"}),(0,T.jsx)("div",{className:"",children:(0,T.jsx)("input",{type:"text",className:"form-control",id:"title",name:"title",value:Z.title,required:!0,onChange:$,disabled:!0})})]}),(0,T.jsxs)(r.Z,{children:[(0,T.jsx)("label",{htmlFor:"department",className:"col-form-label text-end",children:"Department:"}),(0,T.jsx)("div",{className:"",children:(0,T.jsx)("input",{type:"text",className:"form-control",id:"department",name:"department",value:Z.department,required:!0,onChange:$,disabled:!0})})]}),(0,T.jsxs)(r.Z,{children:[(0,T.jsx)("label",{htmlFor:"project",className:"col-form-label text-end",children:"Project:"}),(0,T.jsx)("div",{className:"",children:(0,T.jsx)("input",{type:"text",className:"form-control",id:"project",name:"project",value:Z.project,required:!0,onChange:$,disabled:!0})})]}),(0,T.jsxs)(r.Z,{children:[(0,T.jsx)("label",{htmlFor:"dueDate",className:"col-form-label text-end",children:"Due Date:"}),(0,T.jsx)("div",{className:"",children:(0,T.jsx)("input",{type:"text",className:"form-control",id:"dueDate",name:"dueDate",value:Z.dueDate?Z.dueDate.split("T")[0]:"",required:!0,onChange:$,disabled:!0})})]}),(0,T.jsxs)(o.Z,{show:M,onHide:se,children:[(0,T.jsx)(o.Z.Header,{closeButton:!0,children:(0,T.jsx)(o.Z.Title,{children:"Attachment"})}),(0,T.jsx)(o.Z.Body,{children:B&&(0,T.jsx)("img",{src:"".concat(k,"/").concat(Z.attachment.replace("wwwroot/","")),alt:"Attachment",className:"img-fluid"})}),(0,T.jsx)(o.Z.Footer,{children:(0,T.jsx)(l.Z,{variant:"secondary",onClick:se,children:"Close"})})]})]}),(0,T.jsxs)("h5",{className:"mt-3 d-flex align-items-center justify-content-between",children:[(0,T.jsxs)("div",{children:["Discussion Forum",(0,T.jsx)(l.Z,{className:"ms-2 btn-sm",onClick:()=>{const e=[...b].sort(((e,s)=>new Date(s.timestamp)-new Date(e.timestamp)));C(e)},children:"Sort by Newest"}),(0,T.jsx)(l.Z,{className:"ms-2 btn-sm",onClick:()=>{const e=[...b].sort(((e,s)=>new Date(e.timestamp)-new Date(s.timestamp)));C(e)},children:"Sort by Oldest"})]}),(0,T.jsx)("div",{children:(0,T.jsx)(l.Z,{onClick:()=>{U(!G)},children:G?(0,T.jsx)("i",{className:"fa-solid fa-angles-left"}):(0,T.jsx)("i",{className:"fa-solid fa-angles-right"})})})]}),v&&(0,T.jsx)("div",{className:"alert ".concat(v.includes("successfully")?"alert-success":"alert-danger"),role:"alert",children:v}),(0,T.jsxs)(c.Z,{children:[(0,T.jsxs)(r.Z,{md:G?12:9,children:[(0,T.jsxs)(c.Z,{children:[(0,T.jsxs)(r.Z,{md:7,children:[(0,T.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[(0,T.jsx)("label",{htmlFor:"description",className:"col-form-label text-end",children:"Description:"}),(0,T.jsx)(h.G,{icon:p.Z6I,className:"me-2 text-primary",onClick:ee})]}),(0,T.jsxs)("div",{className:"mb-3",children:[(0,T.jsx)("textarea",{className:"form-control",id:"description",name:"description",value:Z.description,required:!0,onChange:$,rows:"6",disabled:!0}),Z.attachment&&(0,T.jsx)(r.Z,{children:(0,T.jsxs)(l.Z,{className:"mt-3",onClick:()=>{Z.attachment.toLowerCase().endsWith(".png")||Z.attachment.toLowerCase().endsWith(".jpg")||Z.attachment.toLowerCase().endsWith(".jpeg")||Z.attachment.toLowerCase().endsWith(".gif")||Z.attachment.toLowerCase().endsWith(".bmp")?(H(!0),W(!0)):window.open("".concat(k,"/").concat(Z.attachment.replace("wwwroot/","")),"_blank")},children:[(0,T.jsx)(h.G,{icon:p.Alc,className:"me-2"}),"Show Attachment"]})})]})]}),(0,T.jsxs)(r.Z,{md:5,children:[(0,T.jsx)("h5",{className:"mb-3",children:"Ticket Information"}),(0,T.jsxs)(d.Z,{children:[(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Assignee:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.assigneeName,onChange:$,name:"assigneeName",disabled:!0,children:[(0,T.jsx)("option",{value:"",children:"Select Assignee"}),I.map((e=>(0,T.jsx)("option",{value:e.id,children:e.fullName},e.id)))]})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Ticket Type:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.ticketType,onChange:$,name:"ticketType",disabled:!0,children:[(0,T.jsx)("option",{value:"",children:"Select Ticket Type"}),D.map((e=>(0,T.jsx)("option",{value:e.ticketType,children:e.ticketType},e.ticketTypeId)))]})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Status:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.status,onChange:$,name:"status",disabled:!0,children:[(0,T.jsx)("option",{value:"Open",children:"Open"}),(0,T.jsx)("option",{value:"Pending",children:"Pending"}),(0,T.jsx)("option",{value:"Self-Assigned",children:"Self-Assigned"}),(0,T.jsx)("option",{value:"Completed",children:"Completed"})]})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Priority:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.priority,onChange:$,name:"priority",disabled:!0,children:[(0,T.jsx)("option",{value:"high",children:"High"}),(0,T.jsx)("option",{value:"medium",children:"Medium"}),(0,T.jsx)("option",{value:"low",children:"Low"})]})})]})]})]})]}),P&&(0,T.jsxs)(c.Z,{children:[(0,T.jsxs)(r.Z,{md:7,children:[(0,T.jsxs)("div",{className:"mt-3",children:[(0,T.jsx)("label",{htmlFor:"userComment",className:"col-form-label text-end",children:"Your Comment:"}),(0,T.jsx)("div",{className:"mb-3",children:(0,T.jsx)(j(),{value:_,onChange:e=>{N(e)},modules:{toolbar:A}})})]}),(0,T.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{htmlFor:"attachedFile",children:"Attach File"}),(0,T.jsx)(d.Z.Control,{type:"file",id:"attachedFile",name:"attachedFile",onChange:e=>{Y(e.target.files[0])}})]})]}),(0,T.jsxs)(r.Z,{md:5,children:[(0,T.jsx)(c.Z,{className:"mt-3",children:(0,T.jsxs)(d.Z,{children:[(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Assignee:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.userAssigneeId,onChange:$,name:"userAssigneeId",children:[(0,T.jsx)("option",{value:"",children:"Select Assignee "}),I.map((e=>(0,T.jsxs)("option",{value:e.userId,children:[e.fullName,console.log(Z)]},e.userId)))]})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Ticket Type:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.userTicketTypeId,onChange:$,name:"userTicketType",children:[(0,T.jsx)("option",{value:"",children:"Select Ticket Type"}),D.map((e=>(0,T.jsx)("option",{value:e.ticketTypeId,children:e.ticketType},e.ticketTypeId)))]})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Status:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.userStatus,onChange:$,name:"userStatus",children:[(0,T.jsx)("option",{value:"",children:"Select Status"}),(0,T.jsx)("option",{value:"Open",children:"Open"}),(0,T.jsx)("option",{value:"Pending",children:"Pending"}),(0,T.jsx)("option",{value:"Self-Assigned",children:"Self-Assigned"}),(0,T.jsx)("option",{value:"Completed",children:"Completed"})]})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Priority:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsxs)(d.Z.Select,{value:Z.userPriority,onChange:$,name:"userPriority",children:[(0,T.jsx)("option",{value:"",children:"Select Priority"}),(0,T.jsx)("option",{value:"high",children:"High"}),(0,T.jsx)("option",{value:"medium",children:"Medium"}),(0,T.jsx)("option",{value:"low",children:"Low"})]})})]})]})}),(0,T.jsx)(l.Z,{className:"mt-3",onClick:async e=>{e.preventDefault(),X(!0);const s=z.fullName===Z.creatorName,t=z.fullName===Z.assigneeName,a=z.fullName===Z.userAssigneeName;if(s||t||a)try{const e={prev:Z.assigneeId,pre:Z.status,newp:Z.userPriority,pret:Z.userTicketTypeId,newt:Z.userTicketTypeId,newa:Z.userAssigneeId,news:Z.userStatus,prep:Z.priority,ticketid:Z.ticketId,timestamp:(new Date).toISOString(),comment:_},s="".concat("http://api1.chandrakala.co.in/api/TicketFlow","?").concat(new URLSearchParams(e).toString());let t=new FormData;K&&t.append("attachment",K,K.name),console.log("FormData:",t),console.log("File uploaded:",K);const a=await n.Z.post(s,t,{headers:{"Content-Type":"multipart/form-data"}});console.log("Response:",a.data),C([...b,a.data]),N(""),E("Comment submitted successfully!"),ee(),X(!1),f(Z)}catch(i){console.error("Error submitting comment:",i),console.log("Error details:",i.response),console.log("Status code:",i.response.status),E("Error submitting comment. Please try again.")}else E("You are not authorized to comment on this ticket.")},disabled:Q,children:Q?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(m.Z,{animation:"border",size:"sm"})," Submitting Comment..."]}):"Submit Your Comment"})]})]}),b.map(((e,s)=>(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)(c.Z,{className:"border p-2 align-items-center",children:[(0,T.jsxs)(r.Z,{md:7,children:[(0,T.jsx)("div",{className:"d-flex align-items-center justify-content-between mb-3",children:(0,T.jsx)("label",{htmlFor:"description",className:"col-form-label text-end",children:(0,T.jsxs)("p",{children:["Comment by ",e.newAssigneeName," at ",new Date(e.timestamp).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]})})}),(0,T.jsxs)("div",{className:"mb-3",children:[(0,T.jsx)("div",{dangerouslySetInnerHTML:{__html:e.comment}}),e.attachment&&(0,T.jsxs)("div",{children:[(0,T.jsx)("strong",{}),(0,T.jsx)("a",{href:"".concat(k,"/").concat(e.attachment.replace("wwwroot/","")),target:"_blank",rel:"noopener noreferrer",children:(0,T.jsx)(l.Z,{children:"View Attachment"})})]})]})]}),(0,T.jsx)(r.Z,{md:5,children:(0,T.jsxs)(d.Z,{children:[(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Assignee:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsx)(d.Z.Select,{name:"assigneeName",disabled:!0,children:(0,T.jsx)("option",{value:"",children:e.newAssigneeName})})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Ticket Type:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsx)(d.Z.Select,{name:"ticketType",disabled:!0,children:(0,T.jsx)("option",{value:"",children:e.newTicketType})})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Status:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsx)(d.Z.Select,{name:"status",disabled:!0,children:(0,T.jsx)("option",{value:"",children:e.newStatus})})})]}),(0,T.jsxs)(d.Z.Group,{as:c.Z,className:"mb-3",children:[(0,T.jsx)(d.Z.Label,{column:!0,sm:4,children:"Priority:"}),(0,T.jsx)(r.Z,{sm:8,children:(0,T.jsx)(d.Z.Select,{name:"priority",disabled:!0,children:(0,T.jsx)("option",{value:"",children:e.newPriority})})})]})]})})]},s)})))]}),!G&&(0,T.jsx)(r.Z,{md:3,className:"border-start border-end border-2",children:(0,T.jsxs)("div",{children:[(0,T.jsx)("h5",{className:"mb-3",children:"Progress Tracker"}),(0,T.jsx)("ul",{className:"list-group",children:b.map(((e,s)=>(0,T.jsxs)("li",{className:"list-group-item",children:[(0,T.jsx)("strong",{children:new Date(e.timestamp).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),(0,T.jsx)("br",{}),e.newAssigneeEmail&&(0,T.jsxs)("span",{children:["Assigned to: ",e.newAssigneeEmail]})]},s)))})]})})]})]})}},42480:()=>{}}]);
//# sourceMappingURL=5696.7d30319e.chunk.js.map