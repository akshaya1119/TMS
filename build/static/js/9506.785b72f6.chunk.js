(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[9506],{24220:(e,t,a)=>{"use strict";a.d(t,{R:()=>d});var n=a(72791),c=a(89704),s=a.n(c);const i={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_ARCHIEVED:"http://api1.chandrakala.co.in/api/Tickets/ArchivedByUser",REACT_APP_API_CHANGE_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ChangePassword",REACT_APP_API_DEPARTMENTS:"http://api1.chandrakala.co.in/api/Departments",REACT_APP_API_DESIGNATION:"http://api1.chandrakala.co.in/api/Designation",REACT_APP_API_Filter:"http://api1.chandrakala.co.in/api/Tickets/filter",REACT_APP_API_FORGOT_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ForgetPassword",REACT_APP_API_LOGIN:"http://api1.chandrakala.co.in/api/Login",REACT_APP_API_MODULE:"http://api1.chandrakala.co.in/api/Modules",REACT_APP_API_PERMISSION:"http://api1.chandrakala.co.in/api/Permission",REACT_APP_API_PROJECTTYPE:"http://api1.chandrakala.co.in/api/ProjectType",REACT_APP_API_SavedSearch:"http://api1.chandrakala.co.in/api/SearchSave",REACT_APP_API_TICKET:"http://api1.chandrakala.co.in/api/Tickets",REACT_APP_API_TICKETFLOW:"http://api1.chandrakala.co.in/api/TicketFlow",REACT_APP_API_TICKETFLOW_BY_COMMENTS:"http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId",REACT_APP_API_TICKETTYPE:"http://api1.chandrakala.co.in/api/TicketTypes",REACT_APP_API_TICKET_COMPLETED:"http://api1.chandrakala.co.in/api/Tickets/MarkCompleted",REACT_APP_API_UPLOAD:"http://api1.chandrakala.co.in/api/Users/upload",REACT_APP_API_USERS:"http://api1.chandrakala.co.in/api/Users",REACT_APP_API_USER_BY_ID:"http://api1.chandrakala.co.in/api/Users",REACT_APP_BASE_API_URL:"http://api1.chandrakala.co.in/api",REACT_APP_BASE_URL:"http://api1.chandrakala.co.in",REACT_APP_MY_SERVER:"http://ticket.chandrakala.co.in"}.REACT_APP_SECRET_KEY||"ghjsfysdg123",r=(0,n.createContext)({encrypt:e=>s().AES.encrypt(e.toString(),i).toString().replace(/\//g,";"),decrypt:e=>{if("string"!==typeof e)return e;e=e.replace(/;/g,"/");return s().AES.decrypt(e,i).toString(s().enc.Utf8)}}),d=()=>(0,n.useContext)(r)},95513:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var n=a(72791),c=a(47022),s=a(89743),i=a(2677),r=a(43360),d=a(24849),l=a(62591),o=a(97873),h=a(12576),p=a(17612),x=a(88890),j=a.n(x),u=a(11087),m=a(9806),_=a(11632),A=a(55294),k=a(24220),T=a(80184);const P="http://api1.chandrakala.co.in",C=e=>{let{tickets:t,setTickets:a}=e;const{encrypt:c}=(0,k.R)(),[s,i]=(0,n.useState)(!1),[d,x]=(0,n.useState)(null),[C,g]=(0,n.useState)({}),[E,f]=(0,n.useState)(!1),[v,S]=(0,n.useState)(!1),[I,N]=(0,n.useState)(!1),y=(0,n.useRef)(null);(0,n.useEffect)((()=>{y.current&&j()(y.current).DataTable({order:[[4,"desc"]]});t.forEach((e=>{(async e=>{try{const t=await fetch("".concat("http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId","/").concat(e));if(!t.ok)throw new Error("HTTP error! Status: ".concat(t.status));const a=await t.json(),n=a.length>0?a[a.length-1].comment:"No comments";g((t=>({...t,[e]:n})))}catch(t){console.error("Error fetching comments for ticket ".concat(e,":"),t)}})(e.ticketId)}))}),[t]);const R=()=>{x(null),f(!1)},Z=()=>{A.Z.put("".concat("http://api1.chandrakala.co.in/api/Tickets","/").concat(d.ticketId,"/archive")).then((e=>{a(t.filter((e=>e.ticketId!==d.ticketId)))})).catch((e=>{console.error("Error archiving ticket:",e)})),R()};return(0,T.jsxs)("div",{className:"mt-6 table-responsive",children:[(0,T.jsxs)(l.Z,{striped:!0,bordered:!0,hover:!0,ref:y,className:"table-primary",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{children:"S.No"}),(0,T.jsx)("th",{children:"Title"}),(0,T.jsx)("th",{children:"Status"}),(0,T.jsx)("th",{children:"Priority"}),(0,T.jsx)("th",{children:"DueDate"}),(0,T.jsx)("th",{children:"Creator "}),(0,T.jsx)("th",{children:"Actions"})]})}),(0,T.jsx)("tbody",{children:t.map(((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{children:t+1}),(0,T.jsx)("td",{children:(0,T.jsx)(o.Z,{placement:"top",delay:{show:250,hide:400},overlay:(0,T.jsx)(h.Z,{id:"tooltip-".concat(e.ticketId),children:C[e.ticketId]?(0,T.jsxs)(T.Fragment,{children:["Last comment:",(0,T.jsx)("div",{dangerouslySetInnerHTML:{__html:C[e.ticketId]}})]}):(0,T.jsxs)("div",{children:["Description: ",(0,T.jsx)("br",{}),e.description]})}),children:(0,T.jsx)("span",{children:e.title})},e.ticketId)}),(0,T.jsx)("td",{children:e.status}),(0,T.jsx)("td",{children:e.priority}),(0,T.jsx)("td",{children:new Date(e.dueDate).toLocaleString()}),(0,T.jsx)("td",{children:e.creatorName}),(0,T.jsx)("td",{children:(0,T.jsxs)("div",{className:"d-flex gap-3 align-items-center",children:[(0,T.jsx)(u.rU,{to:"/Tickets/EditTicket/".concat(c(e.ticketId)),children:(0,T.jsx)(m.G,{icon:_.e0A,className:"text-primary"})}),(0,T.jsx)(r.Z,{variant:"link",onClick:()=>(e=>{x(e),i(!0)})(e),children:(0,T.jsx)(m.G,{icon:_.Mdf,className:"text-success"})}),(0,T.jsx)(m.G,{icon:_.On6,className:"text-danger",onClick:()=>(e=>{x(e),f(!0)})(e)}),(0,T.jsxs)(p.Z,{show:E,onHide:R,children:[(0,T.jsx)(p.Z.Header,{closeButton:!0,children:(0,T.jsx)(p.Z.Title,{children:"Confirm Archive"})}),(0,T.jsxs)(p.Z.Body,{children:["Are you sure you want to archive ticket ",d?d.id:"","?"]}),(0,T.jsxs)(p.Z.Footer,{children:[(0,T.jsx)(r.Z,{variant:"secondary",onClick:R,children:"Cancel"}),(0,T.jsx)(r.Z,{variant:"danger",onClick:Z,children:"Archive"})]})]})]})})]},e.ticketId)))})]}),d&&(0,T.jsxs)(p.Z,{show:s,onHide:()=>i(!1),size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[(0,T.jsx)(p.Z.Header,{closeButton:!0,children:(0,T.jsx)(p.Z.Title,{id:"contained-modal-title-vcenter",children:"Ticket Details"})}),(0,T.jsxs)(p.Z.Body,{children:[(0,T.jsxs)("p",{children:["Title: ",d.title]}),(0,T.jsxs)("p",{children:["Description: ",d.description]}),(0,T.jsxs)("p",{children:["Creator: ",d.creatorName]}),(0,T.jsxs)("p",{children:["Assignee: ",d.assigneeName]}),(0,T.jsx)("p",{children:"Attachments:"}),d.attachment&&(0,T.jsx)("div",{children:I&&/\.(png|jpg|jpeg|gif|bmp)$/i.test(d.attachment)?(0,T.jsx)("img",{src:"".concat(P,"/").concat(d.attachment.replace("wwwroot/","")),alt:"Attachment",className:"img-fluid"}):(0,T.jsx)("p",{children:(0,T.jsx)("a",{href:"".concat(P,"/").concat(d.attachment.replace("wwwroot/","")),target:"_blank",rel:"noopener noreferrer",children:"View Attachment"})})})]}),(0,T.jsx)(p.Z.Footer,{children:(0,T.jsx)(r.Z,{onClick:()=>i(!1),children:"Close"})})]})]})};var g=a(583),E=a(30734),f=a(45471),v=a(55087),S=a(6265),I=a(58990);a(41112);const N="http://api1.chandrakala.co.in/api/Tickets",y=()=>{const{user:e}=(0,g.a)(),[t,a]=(0,n.useState)({open:0,pending:0,selfassigned:0,completed:0}),[c,s]=(0,n.useState)([]),[i,r]=(0,n.useState)(!0);return(0,n.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(N,"/status-count?id=").concat(e.userId),{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)}}),n=await t.json();a({open:n.openCount,pending:n.pendingCount,selfassigned:n.selfassignedCount,completed:n.completedCount});const c=await fetch("".concat(N,"/ByUser?Id=").concat(e.userId),{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)}}),i=await c.json();s(i),r(!1)}catch(t){console.error("Error fetching data:",t)}finally{r(!1)}})()}),[e]),(0,T.jsx)(E.r,{children:(0,T.jsx)(f.b,{xs:12,className:"d-flex align-items-center justify-content-center",children:(0,T.jsx)(v.x,{className:"mb-4 ",style:{height:"370px"},children:(0,T.jsx)(S.s,{children:0==t.open&&0==t.pending&&0==t.selfassigned&&0==t.completed?(0,T.jsx)(I.fH,{data:{labels:["No Data"],datasets:[{data:[100],backgroundColor:["#CCCCCC"],hoverBackgroundColor:["#CCCCCC"]}]}}):(0,T.jsx)(I.fH,{data:{labels:["Open","Pending","Self-Assigned","Completed"],datasets:[{data:[t.open,t.pending,t.selfassigned,t.completed],backgroundColor:["#08683A","#36A2EB","#FFFF33","#F77000"],hoverBackgroundColor:["#08683A","#36A2EB","#FFFF33","#F77000"]}]}})})})})})};var R=a(54694);const Z=()=>{const[e,t]=(0,n.useState)([]),[a,c]=(0,n.useState)(!1),{user:s,isLoading:i,isError:r}=(0,g.a)(),[d,o]=(0,n.useState)([]),[h,p]=(0,n.useState)([]);(0,n.useEffect)((()=>{i||r||x()}),[i,r,s.email]);const x=async()=>{c(!0);try{const e=(await A.Z.get("".concat("http://api1.chandrakala.co.in","/api/Tickets?userId=").concat(s.userId),{headers:{Authorization:"Bearer ".concat(null===s||void 0===s?void 0:s.token)}})).data.filter((e=>e.assigneeId===s.userId&&"Completed"!=e.status));t(e);const a=j(e),n=u(e);o(a),p(n)}catch(e){console.error("Error fetching tickets:",e)}finally{c(!1)}},j=e=>{const t=(new Date).toISOString().split("T")[0];return e.filter((e=>e.dueDate.split("T")[0]===t))},u=e=>{const t=new Date,a=new Date;return a.setDate(t.getDate()+2),e.filter((e=>{const n=new Date(e.dueDate);return n>t&&n<=a}))};return i?(0,T.jsx)("div",{children:"Loading..."}):r?(0,T.jsx)("div",{children:"Error fetching user data."}):(0,T.jsxs)("div",{children:[0===d.length?(0,T.jsx)(R.Z,{className:"mt-2",children:(0,T.jsx)(R.Z.Body,{children:(0,T.jsx)("div",{className:"text-center",children:"No tasks due today."})})}):(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(R.Z,{className:"mt-2",children:(0,T.jsx)(R.Z.Body,{children:(0,T.jsxs)(l.Z,{striped:!0,bordered:!0,hover:!0,children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{children:"S.No"}),(0,T.jsx)("th",{children:"Title"}),(0,T.jsx)("th",{children:"Deadline"})]})}),(0,T.jsx)("tbody",{children:d.map(((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{children:t+1}),(0,T.jsx)("td",{children:e.title}),(0,T.jsx)("td",{children:e.dueDate.split("T")[0]})]},e.ticketId)))})]})})})}),h.length>0&&(0,T.jsx)(R.Z,{className:"mt-2",children:(0,T.jsxs)(R.Z.Body,{children:[(0,T.jsx)("h5",{children:"Upcoming Due Date Tasks"}),(0,T.jsxs)(l.Z,{striped:!0,bordered:!0,hover:!0,children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{children:"S.No"}),(0,T.jsx)("th",{children:"Title"}),(0,T.jsx)("th",{children:"Deadline"})]})}),(0,T.jsx)("tbody",{children:h.map(((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{children:t+1}),(0,T.jsx)("td",{children:e.title}),(0,T.jsx)("td",{children:e.dueDate.split("T")[0]})]},e.ticketId)))})]})]})})]})};var D=a(57689);const w="http://api1.chandrakala.co.in/api/Tickets",b=()=>{const{user:e}=(0,g.a)(),[t,a]=(0,n.useState)({open:0,pending:0,selfassigned:0,completed:0}),[l,o]=(0,n.useState)([]),[h,p]=(0,n.useState)(!0),[x,j]=(0,n.useState)(!1);(0,D.s0)();(0,n.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(w,"/status-count?id=").concat(e.userId),{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)}}),n=await t.json();a({open:n.openCount,pending:n.pendingCount,selfassigned:n.selfassignedCount,completed:n.completedCount}),console.log("Token:",null===e||void 0===e?void 0:e.token);const c=await fetch("".concat(w,"/ByUser?Id=").concat(e.userId),{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)}}),s=await c.json();o(s),p(!1)}catch(t){console.error("Error fetching data:",t)}finally{p(!1)}})()}),[e]);return(0,T.jsxs)("div",{children:[(0,T.jsx)(c.Z,{children:(0,T.jsxs)(s.Z,{className:"row-cols-1 row-cols-md-2",children:[(0,T.jsxs)(i.Z,{md:6,children:[(0,T.jsxs)(s.Z,{className:"mb-3",children:[(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.open})}),(0,T.jsx)("p",{className:"name-client",children:"Open"})]})}),(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.pending})}),(0,T.jsx)("p",{className:"name-client",children:"Pending"})]})})]}),(0,T.jsxs)(s.Z,{children:[(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.selfassigned})}),(0,T.jsx)("p",{className:"name-client",children:"Self Assigned"})]})}),(0,T.jsx)(i.Z,{children:(0,T.jsxs)("div",{className:"card-client",children:[(0,T.jsx)("div",{className:"user-picture",children:(0,T.jsx)("p",{className:"number",children:t.completed})}),(0,T.jsx)("p",{className:"name-client",children:"Completed"})]})})]})]}),(0,T.jsx)(i.Z,{md:4,style:{display:x?"none":"block"},children:(0,T.jsx)(y,{})}),(0,T.jsxs)(i.Z,{md:!x&&2,children:[(0,T.jsx)(s.Z,{children:(0,T.jsx)(i.Z,{children:(0,T.jsx)("div",{className:"text-end",children:(0,T.jsx)(r.Z,{onClick:()=>{j(!x)},variant:"danger",children:"Due Today"})})})}),(0,T.jsx)(s.Z,{children:(0,T.jsx)(i.Z,{children:x&&(0,T.jsx)(Z,{})})})]})]})}),h?(0,T.jsx)("div",{className:"text-center",children:(0,T.jsx)(d.Z,{animation:"border",role:"status",children:(0,T.jsx)("span",{className:"visually-hidden",children:"loading.."})})}):(0,T.jsx)(C,{tickets:l,setTickets:o})]})}},42480:()=>{}}]);
//# sourceMappingURL=9506.785b72f6.chunk.js.map