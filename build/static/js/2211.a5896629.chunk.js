(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[2211],{24220:(t,e,a)=>{"use strict";a.d(e,{R:()=>o});var c=a(72791),i=a(89704),n=a.n(i);const r={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_ARCHIEVED:"http://api1.chandrakala.co.in/api/Tickets/ArchivedByUser",REACT_APP_API_CHANGE_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ChangePassword",REACT_APP_API_DEPARTMENTS:"http://api1.chandrakala.co.in/api/Departments",REACT_APP_API_DESIGNATION:"http://api1.chandrakala.co.in/api/Designation",REACT_APP_API_FORGOT_PASSWORD:"http://api1.chandrakala.co.in/api/Login/ForgetPassword",REACT_APP_API_LOGIN:"http://api1.chandrakala.co.in/api/Login",REACT_APP_API_MODULE:"http://api1.chandrakala.co.in/api/Modules",REACT_APP_API_PERMISSION:"http://api1.chandrakala.co.in/api/Permission",REACT_APP_API_PROJECTTYPE:"http://api1.chandrakala.co.in/api/ProjectType",REACT_APP_API_TICKET:"http://api1.chandrakala.co.in/api/Tickets",REACT_APP_API_TICKETFLOW:"http://api1.chandrakala.co.in/api/TicketFlow",REACT_APP_API_TICKETFLOW_BY_COMMENTS:"http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId",REACT_APP_API_TICKETTYPE:"http://api1.chandrakala.co.in/api/TicketTypes",REACT_APP_API_TICKET_COMPLETED:"http://api1.chandrakala.co.in/api/Tickets/MarkCompleted",REACT_APP_API_UPLOAD:"http://api1.chandrakala.co.in/api/Users/upload",REACT_APP_API_USERS:"http://api1.chandrakala.co.in/api/Users",REACT_APP_API_USER_BY_ID:"http://api1.chandrakala.co.in/api/Users",REACT_APP_BASE_API_URL:"http://api1.chandrakala.co.in/api",REACT_APP_BASE_URL:"http://api1.chandrakala.co.in",REACT_APP_MY_SERVER:"http://test1.chandrakala.co.in"}.REACT_APP_SECRET_KEY||"ghjsfysdg123",s=(0,c.createContext)({encrypt:t=>{console.log("Data to encrypt:",t);const e=n().AES.encrypt(t.toString(),r).toString();return console.log("Encrypted data:",e),e.replace(/\//g,";")},decrypt:t=>{if("string"!==typeof t)return t;t=t.replace(/;/g,"/");return n().AES.decrypt(t,r).toString(n().enc.Utf8)}}),o=()=>(0,c.useContext)(s)},95507:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>C});var c=a(72791),i=a(62591),n=a(97873),r=a(12576),s=a(43360),o=a(17612),l=a(11087),d=a(88890),h=a.n(d),p=a(9806),_=a(11632),A=a(55294),T=a(24220),x=a(583),P=a(80184);const k="http://api1.chandrakala.co.in",j=t=>{let{tickets:e,hasPermission:a,setTickets:d}=t;const[j,u]=(0,c.useState)(!1),[E,m]=(0,c.useState)(null),[I,C]=(0,c.useState)({}),y=(0,c.useRef)(null),[S,g]=(0,c.useState)(!1),[f,R]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),{encrypt:D}=(0,T.R)(),{user:N}=(0,x.a)();(0,c.useEffect)((()=>{e.forEach((t=>{(async t=>{try{const e=await fetch("".concat("http://api1.chandrakala.co.in/api/TicketFlow/CommentsByTicketId","/").concat(t));if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));const a=await e.json(),c=a.length>0?a[a.length-1].comment:"No comments";C((e=>({...e,[t]:c})))}catch(e){console.error("Error fetching comments for ticket ".concat(t,":"),e)}})(t.ticketId)}))}),[e]),(0,c.useEffect)((()=>{y.current&&h()(y.current).DataTable()}),[]);const O=()=>{m(null),g(!1)},Z=()=>{console.log("Archiving ticket:",E),A.Z.post("".concat("http://api1.chandrakala.co.in/api/Tickets","/").concat(E.ticketId,"/archive?userId=").concat(N.userId)).then((t=>{console.log("Ticket archived successfully:",t.data),d(e.filter((t=>t.ticketId!==E.ticketId)))})).catch((t=>{console.error("Error archiving ticket:",t)})),O()};return(0,P.jsxs)("div",{className:"mt-6 table-responsive",children:[(0,P.jsxs)(i.Z,{ref:y,striped:!0,bordered:!0,hover:"sm",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"S.No"}),(0,P.jsx)("th",{children:"TicketID"}),(0,P.jsx)("th",{children:"Title"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Priority"}),(0,P.jsx)("th",{children:"TicketType"}),(0,P.jsx)("th",{children:"DueDate"}),(0,P.jsx)("th",{children:"Department"}),(0,P.jsx)("th",{children:"ProjectType"}),(0,P.jsx)("th",{children:"Actions"})]})}),(0,P.jsx)("tbody",{children:e.map(((t,e)=>(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{children:e+1}),(0,P.jsx)("td",{children:t.ticketId}),(0,P.jsx)("td",{children:(0,P.jsx)(n.Z,{placement:"top",delay:{show:250,hide:400},overlay:(0,P.jsx)(r.Z,{id:"tooltip-".concat(t.ticketId),children:I[t.ticketId]?(0,P.jsxs)(P.Fragment,{children:["Last comment:",(0,P.jsx)("div",{dangerouslySetInnerHTML:{__html:I[t.ticketId]}})]}):(0,P.jsxs)("div",{children:["Description: ",(0,P.jsx)("br",{}),t.description]})}),children:(0,P.jsx)("span",{className:"text-truncate d-inline-block ",style:{maxWidth:"150px"},children:t.title})},t.ticketId)}),(0,P.jsx)("td",{children:t.status}),(0,P.jsx)("td",{children:t.priority}),(0,P.jsx)("td",{children:t.ticketType}),(0,P.jsx)("td",{children:new Date(t.dueDate).toLocaleString()}),(0,P.jsx)("td",{children:t.department}),(0,P.jsx)("td",{children:t.project}),(0,P.jsx)("td",{children:(0,P.jsxs)("div",{className:"d-flex gap-3 align-items-center",children:[a(2,"canUpdateOnly")&&(0,P.jsx)(l.rU,{to:"EditTicket/".concat(D(t.ticketId)),children:(0,P.jsx)(p.G,{icon:_.e0A,className:"text-primary"})}),a(2,"canViewOnly")&&(0,P.jsx)(s.Z,{variant:"link",onClick:()=>(t=>{m(t),u(!0)})(t),children:(0,P.jsx)(p.G,{icon:_.Mdf,className:"text-success"})}),a(2,"canDeleteOnly")&&(0,P.jsx)(p.G,{icon:_.On6,className:"text-danger",onClick:()=>(t=>{m(t),g(!0)})(t)}),(0,P.jsxs)(o.Z,{show:S,onHide:O,children:[(0,P.jsx)(o.Z.Header,{closeButton:!0,children:(0,P.jsx)(o.Z.Title,{children:"Confirm Archive"})}),(0,P.jsxs)(o.Z.Body,{children:["Are you sure you want to archive ticket ",E?E.id:"","?"]}),(0,P.jsxs)(o.Z.Footer,{children:[(0,P.jsx)(s.Z,{variant:"secondary",onClick:O,children:"Cancel"}),(0,P.jsx)(s.Z,{variant:"danger",onClick:Z,children:"Archive"})]})]})]})})]},t.ticketId)))})]}),E&&(0,P.jsxs)(o.Z,{show:j,onHide:()=>u(!1),size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[(0,P.jsx)(o.Z.Header,{closeButton:!0,children:(0,P.jsx)(o.Z.Title,{id:"contained-modal-title-vcenter",children:"Ticket Details"})}),(0,P.jsxs)(o.Z.Body,{children:[(0,P.jsxs)("p",{children:["Title: ",E.title]}),(0,P.jsxs)("p",{children:["Description: ",E.description]}),(0,P.jsxs)("p",{children:["Creator: ",E.creatorName]}),(0,P.jsxs)("p",{children:["Assignee: ",E.assigneeName]}),(0,P.jsx)("p",{children:"Attachments:"}),E.attachment&&(0,P.jsx)("div",{children:v&&/\.(png|jpg|jpeg|gif|bmp)$/i.test(E.attachment)?(0,P.jsx)("img",{src:"".concat(k,"/").concat(E.attachment.replace("wwwroot/","")),alt:"Attachment",className:"img-fluid"}):(0,P.jsx)("p",{children:(0,P.jsx)("a",{href:"".concat(k,"/").concat(E.attachment.replace("wwwroot/","")),target:"_blank",rel:"noopener noreferrer",children:"View Attachment"})})})]}),(0,P.jsx)(o.Z.Footer,{children:(0,P.jsx)(s.Z,{onClick:()=>u(!1),children:"Close"})})]})]})};var u=a(24849),E=a(36704),m=a(57689);const I="http://api1.chandrakala.co.in/api/Tickets",C=()=>{const[t,e]=(0,c.useState)([]),[a,i]=(0,c.useState)([]),[n,r]=(0,c.useState)(!0),[o,l]=(0,c.useState)("All"),[d,h]=(0,c.useState)("All"),[p,_]=(0,c.useState)([]),{user:A}=(0,x.a)();let T=(0,m.s0)();const k=()=>{T("/Tickets/AddTicket")},C=async t=>{try{const e=await fetch(t);if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return await e.json()}catch(e){throw console.error("Error fetching data:",e),e}};return(0,c.useEffect)((()=>{(async()=>{try{const t=await C("".concat(I,"?userId=").concat(A.userId));e(t),r(!1)}catch(t){r(!1)}})()}),[A.userId]),(0,c.useEffect)((()=>{(async()=>{try{let e=[...t];i(e)}catch(e){console.error("Error applying filters:",e)}})()}),[t]),(0,c.useEffect)((()=>{(async()=>{try{const t=await C("".concat(I,"?userId=").concat(A.userId)),a=await C("".concat("http://api1.chandrakala.co.in/api/Tickets/ArchivedByUser","?userId=").concat(A.userId));e(t),_(a),r(!1)}catch(t){r(!1)}})()}),[A.userId]),(0,P.jsx)(E.Z,{children:c=>{let{hasPermission:i}=c;return(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{className:"d-flex justify-content-between mb-3",children:[(0,P.jsx)("h4",{children:"All Tickets"}),(0,P.jsx)("div",{className:"d-flex gap-2 align-items-center",children:i(2,"canAddOnly")&&(0,P.jsx)(s.Z,{type:"button",className:"btn btn-primary",onClick:k,children:"Add Ticket"})})]}),(0,P.jsx)("div",{children:n?(0,P.jsx)("div",{className:"text-center",children:(0,P.jsx)(u.Z,{animation:"border",role:"status",children:(0,P.jsx)("span",{className:"visually-hidden",children:"loading.."})})}):(0,P.jsx)(j,{tickets:"All"!==d||"All"!==o?a:t,hasPermission:i,setTickets:e})})]})}})}},42480:()=>{}}]);
//# sourceMappingURL=2211.a5896629.chunk.js.map